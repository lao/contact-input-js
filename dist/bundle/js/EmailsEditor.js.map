{"version":3,"file":"EmailsEditor.js","sources":["../../../src/emailsEditor.js"],"sourcesContent":["/* eslint-disable no-console */\nimport './main.scss';\n// TODO: turn this into createElement and EXTERNALIZE\nconst REMOVE_SVG = `<svg class=\"remove-icon-svg\" width=\"8\" height=\"8\" viewBox=\"0 0 8 8\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M8 0.8L7.2 0L4 3.2L0.8 0L0 0.8L3.2 4L0 7.2L0.8 8L4 4.8L7.2 8L8 7.2L4.8 4L8 0.8Z\" fill=\"#050038\"/>\n</svg>`;\n\n// TODO: add random email\n\nexport default class emailsEditor {\n  constructor(config) {\n    config = config || {};\n\n    if (!config || !config.container) {\n      console.log('invalid config exiting...');\n      return;\n    }\n\n    this\n      .initValues(config)\n      .renderMainContainer()\n      .initListeners();\n  }\n\n  initValues(config) {\n    this.emails = {};\n    this.onChange = config.onChange;\n    this.container = config.container;\n    this.onGetCount = config.onGetCount;\n    return this;\n  }\n\n  getEmails() {\n    return Object.keys(this.emails);\n  }\n\n  /**\n   * It receives list of emails and append valids to the local list plus renders valid emails only\n   */\n  setEmails(emails) {\n    if(!emails || !emails.length) {\n      return;\n    }\n    const emailsTemp = emails.reduce((email, nonRendered) => {\n      if(this.isValidEmail(email)) {\n        nonRendered.append(email);\n        this.emails[email] = true;\n      }\n      return nonRendered;\n    }, []);\n    this.renderEmails(emailsTemp.list);\n    // [Decided not to do as setEmails, seems to be useful only for appending]\n    // TODO: remove preexisting emails\n  }\n\n  dispatchOnChange() {\n    console.log('hello');\n    return this;\n  }\n\n  initListeners() {\n    const {container} = this;\n    const input = container.querySelector('input');\n    const ballonsContainer = container.querySelector('.ballons-container');\n    const getCountBtn = container.querySelector('.btn-count');\n    const keys = {\n      ENTER: 13,\n      COMMA: 188,\n    };\n    const keyUpListener = e => {\n      const { keyCode, currentTarget, ctrlKey, metaKey } = e || {};\n      if (keyCode === keys.COMMA || keyCode === keys.ENTER) {\n        const emailsBefore = Object.keys(this.emails);\n        this\n          .renderEmails(currentTarget.value)\n          .dispatchOnChange(emailsBefore, currentTarget.value)\n          .cleanInput();\n      }\n      if (metaKey || ctrlKey) {\n        return false;\n      }\n      return e;\n    };\n    const pasteListener = e => {\n      const { currentTarget, clipboardData } = e || {};\n      const clipBoardText = clipboardData.getData('text');\n\n      this\n        .renderEmails(currentTarget.value+clipBoardText)\n        .cleanInput();\n\n      e.preventDefault();\n    };\n    const ballonsClickHandler = e => {\n      const isClickOnSvg = e.target.getAttribute('class') === 'remove-icon-svg';\n      const target = isClickOnSvg ? e.target.parentElement : e.target;\n\n      if (target.className === 'remove-icon') {\n        if (target.parentElement.className !== 'invalid ballon') {\n          delete this.emails[target.parentElement.getAttribute('data-email')];\n        }\n        ballonsContainer.removeChild(target.parentElement);\n      }\n    };\n\n    input.addEventListener('paste', pasteListener);\n    input.addEventListener('keyup', keyUpListener);\n    ballonsContainer.addEventListener('click', ballonsClickHandler);\n\n    if (this.onGetCount && this.onGetCount instanceof Function) {\n      getCountBtn.addEventListener('click', () => {\n        const emails = Object.keys(this.emails);\n        this.onGetCount(emails.length);\n      });\n    }\n\n    return this;\n  }\n\n  renderEmailBlock(string, valid) {\n    const removeIconDiv = document.createElement('div');\n    removeIconDiv.className = !valid ? 'invalid ballon' : 'ballon';\n    // TODO: turn this into createElement\n    removeIconDiv.innerHTML = `${string} <div class=\"remove-icon\">${REMOVE_SVG}</div>`;\n    removeIconDiv.setAttribute('data-email', valid ? string : '');\n    return removeIconDiv;\n  }\n\n  isValidEmail(string) {\n    // eslint-disable-next-line max-len\n    const emailRegx = /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/g;\n    return !!emailRegx.exec(string);\n  }\n\n  /**\n   * It break string value into blocks by comma, checks if is valid, adds to local copy of valid emails\n   * and then renders, all in one go for performance purposes.\n   */\n  renderEmails(stringValue, values) {\n    const blocks = values || (stringValue || '').split(',');\n    const ballonsBlockFrag = document.createDocumentFragment();\n\n    blocks.map((block) => {\n      if(!(block + '').trim()) {return;}\n      const isEmail = this.isValidEmail(block);\n      ballonsBlockFrag.appendChild(this.renderEmailBlock(block, isEmail));\n\n      // validations and saving to local copy\n      if (isEmail) {\n        this.emails[block] = true;\n      }\n    });\n\n    const inputEl = this.container.querySelector('.input-container');\n    this.container\n      .querySelector('.ballons-container')\n      .insertBefore(ballonsBlockFrag, inputEl);\n\n    return this;\n  }\n\n  cleanInput() {\n    const {container} = this;\n    const input = container.querySelector('input');\n    input.value = '';\n    return this;\n  }\n\n  /**\n   * Renders main html container for editor\n   */\n  renderMainContainer() {\n    const {container} = this;\n    // TODO: turn this to createDocumentFragment later\n    const template = `\n      <div class=\"container\">\n        <div class=\"top\">\n          <h1>Share <strong>Board name</strong> with others</h1>\n          <div class=\"text-container\">\n            <div class=\"ballons-container\">\n              <div class=\"input-container\"><input placeholder=\"add more people...\"/></div>\n            </div>\n          </div>\n        </div>\n        <div class=\"bottom\">\n          <button>\n            Add email\n          </button>  \n          <button class=\"btn-count\">\n            Get emails count\n          </button>\n        </div>\n      </div>\n    `;\n    container.innerHTML = template;\n    return this;\n  }\n}\n"],"names":["REMOVE_SVG","emailsEditor","config","container","console","log","initValues","renderMainContainer","initListeners","emails","onChange","onGetCount","Object","keys","length","emailsTemp","reduce","email","nonRendered","isValidEmail","append","renderEmails","list","input","querySelector","ballonsContainer","getCountBtn","ENTER","COMMA","keyUpListener","e","keyCode","currentTarget","ctrlKey","metaKey","emailsBefore","value","dispatchOnChange","cleanInput","pasteListener","clipboardData","clipBoardText","getData","preventDefault","ballonsClickHandler","isClickOnSvg","target","getAttribute","parentElement","className","removeChild","addEventListener","Function","string","valid","removeIconDiv","document","createElement","innerHTML","setAttribute","emailRegx","exec","stringValue","values","blocks","split","ballonsBlockFrag","createDocumentFragment","map","block","trim","isEmail","appendChild","renderEmailBlock","inputEl","insertBefore","template"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;EAGA,IAAMA,UAAU,wSAAhB;MAMqBC;;EACnB,wBAAYC,MAAZ,EAAoB;EAAA;EAClBA,IAAAA,MAAM,GAAGA,MAAM,IAAI,EAAnB;EAEA,QAAI,CAACA,MAAD,IAAW,CAACA,MAAM,CAACC,SAAvB,EAAkC;EAChCC,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ;EACA;EACD;EAED,SACGC,UADH,CACcJ,MADd,EAEGK,mBAFH,GAGGC,aAHH;EAID;;;iCAEUN,QAAQ;EACjB,WAAKO,MAAL,GAAc,EAAd;EACA,WAAKC,QAAL,GAAgBR,MAAM,CAACQ,QAAvB;EACA,WAAKP,SAAL,GAAiBD,MAAM,CAACC,SAAxB;EACA,WAAKQ,UAAL,GAAkBT,MAAM,CAACS,UAAzB;EACA,aAAO,IAAP;EACD;;;kCAEW;EACV,aAAOC,MAAM,CAACC,IAAP,CAAY,KAAKJ,MAAjB,CAAP;EACD;;;gCAKSA,QAAQ;EAAA;EAChB,UAAG,CAACA,MAAD,IAAW,CAACA,MAAM,CAACK,MAAtB,EAA8B;EAC5B;EACD;EACD,UAAMC,UAAU,GAAGN,MAAM,CAACO,MAAP,CAAc,UAACC,KAAD,EAAQC,WAAR,EAAwB;EACvD,YAAG,KAAI,CAACC,YAAL,CAAkBF,KAAlB,CAAH,EAA6B;EAC3BC,UAAAA,WAAW,CAACE,MAAZ,CAAmBH,KAAnB;EACA,UAAA,KAAI,CAACR,MAAL,CAAYQ,KAAZ,IAAqB,IAArB;EACD;EACD,eAAOC,WAAP;EACD,OANkB,EAMhB,EANgB,CAAnB;EAOA,WAAKG,YAAL,CAAkBN,UAAU,CAACO,IAA7B,EAXgB;EAcjB;;;yCAEkB;EACjBlB,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;EACA,aAAO,IAAP;EACD;;;sCAEe;EAAA;EAAA,UACPF,SADO,GACM,IADN,CACPA,SADO;EAEd,UAAMoB,KAAK,GAAGpB,SAAS,CAACqB,aAAV,CAAwB,OAAxB,CAAd;EACA,UAAMC,gBAAgB,GAAGtB,SAAS,CAACqB,aAAV,CAAwB,oBAAxB,CAAzB;EACA,UAAME,WAAW,GAAGvB,SAAS,CAACqB,aAAV,CAAwB,YAAxB,CAApB;EACA,UAAMX,IAAI,GAAG;EACXc,QAAAA,KAAK,EAAE,EADI;EAEXC,QAAAA,KAAK,EAAE;EAFI,OAAb;EAIA,UAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAAAC,CAAC,EAAI;EAAA,mBAC4BA,CAAC,IAAI,EADjC;EAAA,YACjBC,OADiB,QACjBA,OADiB;EAAA,YACRC,aADQ,QACRA,aADQ;EAAA,YACOC,OADP,QACOA,OADP;EAAA,YACgBC,OADhB,QACgBA,OADhB;EAEzB,YAAIH,OAAO,KAAKlB,IAAI,CAACe,KAAjB,IAA0BG,OAAO,KAAKlB,IAAI,CAACc,KAA/C,EAAsD;EACpD,cAAMQ,YAAY,GAAGvB,MAAM,CAACC,IAAP,CAAY,MAAI,CAACJ,MAAjB,CAArB;EACA,UAAA,MAAI,CACDY,YADH,CACgBW,aAAa,CAACI,KAD9B,EAEGC,gBAFH,CAEoBF,YAFpB,EAEkCH,aAAa,CAACI,KAFhD,EAGGE,UAHH;EAID;EACD,YAAIJ,OAAO,IAAID,OAAf,EAAwB;EACtB,iBAAO,KAAP;EACD;EACD,eAAOH,CAAP;EACD,OAbD;EAcA,UAAMS,aAAa,GAAG,SAAhBA,aAAgB,CAAAT,CAAC,EAAI;EAAA,oBACgBA,CAAC,IAAI,EADrB;EAAA,YACjBE,aADiB,SACjBA,aADiB;EAAA,YACFQ,aADE,SACFA,aADE;EAEzB,YAAMC,aAAa,GAAGD,aAAa,CAACE,OAAd,CAAsB,MAAtB,CAAtB;EAEA,QAAA,MAAI,CACDrB,YADH,CACgBW,aAAa,CAACI,KAAd,GAAoBK,aADpC,EAEGH,UAFH;EAIAR,QAAAA,CAAC,CAACa,cAAF;EACD,OATD;EAUA,UAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAAd,CAAC,EAAI;EAC/B,YAAMe,YAAY,GAAGf,CAAC,CAACgB,MAAF,CAASC,YAAT,CAAsB,OAAtB,MAAmC,iBAAxD;EACA,YAAMD,MAAM,GAAGD,YAAY,GAAGf,CAAC,CAACgB,MAAF,CAASE,aAAZ,GAA4BlB,CAAC,CAACgB,MAAzD;EAEA,YAAIA,MAAM,CAACG,SAAP,KAAqB,aAAzB,EAAwC;EACtC,cAAIH,MAAM,CAACE,aAAP,CAAqBC,SAArB,KAAmC,gBAAvC,EAAyD;EACvD,mBAAO,MAAI,CAACxC,MAAL,CAAYqC,MAAM,CAACE,aAAP,CAAqBD,YAArB,CAAkC,YAAlC,CAAZ,CAAP;EACD;EACDtB,UAAAA,gBAAgB,CAACyB,WAAjB,CAA6BJ,MAAM,CAACE,aAApC;EACD;EACF,OAVD;EAYAzB,MAAAA,KAAK,CAAC4B,gBAAN,CAAuB,OAAvB,EAAgCZ,aAAhC;EACAhB,MAAAA,KAAK,CAAC4B,gBAAN,CAAuB,OAAvB,EAAgCtB,aAAhC;EACAJ,MAAAA,gBAAgB,CAAC0B,gBAAjB,CAAkC,OAAlC,EAA2CP,mBAA3C;EAEA,UAAI,KAAKjC,UAAL,IAAmB,KAAKA,UAAL,YAA2ByC,QAAlD,EAA4D;EAC1D1B,QAAAA,WAAW,CAACyB,gBAAZ,CAA6B,OAA7B,EAAsC,YAAM;EAC1C,cAAM1C,MAAM,GAAGG,MAAM,CAACC,IAAP,CAAY,MAAI,CAACJ,MAAjB,CAAf;EACA,UAAA,MAAI,CAACE,UAAL,CAAgBF,MAAM,CAACK,MAAvB;EACD,SAHD;EAID;EAED,aAAO,IAAP;EACD;;;uCAEgBuC,QAAQC,OAAO;EAC9B,UAAMC,aAAa,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAtB;EACAF,MAAAA,aAAa,CAACN,SAAd,GAA0B,CAACK,KAAD,GAAS,gBAAT,GAA4B,QAAtD,CAF8B;EAI9BC,MAAAA,aAAa,CAACG,SAAd,aAA6BL,MAA7B,yCAAgErD,UAAhE;EACAuD,MAAAA,aAAa,CAACI,YAAd,CAA2B,YAA3B,EAAyCL,KAAK,GAAGD,MAAH,GAAY,EAA1D;EACA,aAAOE,aAAP;EACD;;;mCAEYF,QAAQ;EAEnB,UAAMO,SAAS,GAAG,qJAAlB;EACA,aAAO,CAAC,CAACA,SAAS,CAACC,IAAV,CAAeR,MAAf,CAAT;EACD;;;mCAMYS,aAAaC,QAAQ;EAAA;EAChC,UAAMC,MAAM,GAAGD,MAAM,IAAI,CAACD,WAAW,IAAI,EAAhB,EAAoBG,KAApB,CAA0B,GAA1B,CAAzB;EACA,UAAMC,gBAAgB,GAAGV,QAAQ,CAACW,sBAAT,EAAzB;EAEAH,MAAAA,MAAM,CAACI,GAAP,CAAW,UAACC,KAAD,EAAW;EACpB,YAAG,CAAC,CAACA,KAAK,GAAG,EAAT,EAAaC,IAAb,EAAJ,EAAyB;EAAC;EAAQ;EAClC,YAAMC,OAAO,GAAG,MAAI,CAACpD,YAAL,CAAkBkD,KAAlB,CAAhB;EACAH,QAAAA,gBAAgB,CAACM,WAAjB,CAA6B,MAAI,CAACC,gBAAL,CAAsBJ,KAAtB,EAA6BE,OAA7B,CAA7B,EAHoB;EAMpB,YAAIA,OAAJ,EAAa;EACX,UAAA,MAAI,CAAC9D,MAAL,CAAY4D,KAAZ,IAAqB,IAArB;EACD;EACF,OATD;EAWA,UAAMK,OAAO,GAAG,KAAKvE,SAAL,CAAeqB,aAAf,CAA6B,kBAA7B,CAAhB;EACA,WAAKrB,SAAL,CACGqB,aADH,CACiB,oBADjB,EAEGmD,YAFH,CAEgBT,gBAFhB,EAEkCQ,OAFlC;EAIA,aAAO,IAAP;EACD;;;mCAEY;EAAA,UACJvE,SADI,GACS,IADT,CACJA,SADI;EAEX,UAAMoB,KAAK,GAAGpB,SAAS,CAACqB,aAAV,CAAwB,OAAxB,CAAd;EACAD,MAAAA,KAAK,CAACa,KAAN,GAAc,EAAd;EACA,aAAO,IAAP;EACD;;;4CAKqB;EAAA,UACbjC,SADa,GACA,IADA,CACbA,SADa;EAGpB,UAAMyE,QAAQ,qlBAAd;EAoBAzE,MAAAA,SAAS,CAACuD,SAAV,GAAsBkB,QAAtB;EACA,aAAO,IAAP;EACD;;;;;;;;;;;"}